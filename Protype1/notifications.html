<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Notifications</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="notifications.css">
</head>
<body class="bg-neutral-50">
<script>
  // Redirect to login if not authenticated
  if (!localStorage.getItem("loggedInUserId")) {
    localStorage.setItem("redirectAfterLogin", window.location.href);
    window.location.href = "login_signup.html";
  }
</script>

<header class="top-bar">
  <div class="brand-group">
    <div class="brand-logo">U</div>
    <div class="logo-title">University Marketplace</div>
  </div>

  <nav class="nav-bubbles" aria-label="Main navigation">
    <a href="messages.html" class="nav-bubble">ğŸ’¬ Messages</a>
    <a href="index.html" class="nav-bubble">ğŸ›’ Marketplace</a>
    <a href="seller-dashboard.html" class="nav-bubble">ğŸ“‹ My Listings</a>
    <a href="postitem.html" class="nav-bubble sell-button">â• Sell Item</a>
  </nav>

  <div class="top-actions">
    <div class="search-container">
      <input type="text" class="search-input" placeholder="Search" aria-label="Search">
      <button class="search-btn" aria-label="Search">ğŸ”</button>
    </div>
    <div class="top-icons">
      <a href="notifications.html" class="icon-bubble active" aria-label="Notifications">ğŸ””</a>
      <a href="profile.html" class="icon-bubble" aria-label="Profile">ğŸ‘¤</a>
    </div>
  </div>
</header>

<main class="page-shell">
  <div class="section-card">
    <div class="section-header">
      <h1 class="section-title">Notifications</h1>
      <span class="pill">Live feed</span>
    </div>
    <div class="notifications-list" id="notificationsList">
      <p class="muted">Loading your notifications...</p>
    </div>
  </div>
</main>

<script>
function getCurrentUser() {
  const logged = JSON.parse(localStorage.getItem("loggedInUser"));
  return logged || { email: localStorage.getItem("loggedInUserId") };
}

// Load notifications dynamically
function loadNotifications() {
  const user = getCurrentUser();
  const all = JSON.parse(localStorage.getItem("notifications")) || [];
  const myNotifications = all.filter(n => n.userEmail === user.email);
  const list = document.getElementById("notificationsList");

  list.innerHTML = "";

  if (myNotifications.length === 0) {
    list.innerHTML = "<p>No notifications yet.</p>";
    return;
  }

  myNotifications
    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
    .forEach(n => {
      const div = document.createElement("div");
      div.className = `notification ${!n.read ? "unread" : ""}`;
      const icon = n.type === "message" ? "ğŸ’¬" :
                   n.type === "sale" ? "ğŸ›’" :
                   n.type === "review" ? "â­" : "ğŸ””";

      div.innerHTML = `
        <div class="icon">${icon}</div>
        <div class="text">
          <strong>${n.title}</strong>
          <p>${n.details}</p>
          <span class="time">${new Date(n.timestamp).toLocaleString()}</span>
        </div>
        ${!n.read ? '<button class="mark-read">Mark as read</button>' : ""}
      `;

      const btn = div.querySelector(".mark-read");
      if (btn) {
        btn.addEventListener("click", () => {
          n.read = true;
          localStorage.setItem("notifications", JSON.stringify(all));
          loadNotifications();
        });
      }

      list.appendChild(div);
    });
}

// Demo notifications (for testing)
if (!localStorage.getItem("notifications")) {
  const sample = [
    {
      id: 1,
      userEmail: "test@ucf.edu",
      type: "message",
      title: "New Message from Alex",
      details: "Alex sent you a message about 'Desk Lamp'.",
      timestamp: new Date().toISOString(),
      read: false
    },
    {
      id: 2,
      userEmail: "test@ucf.edu",
      type: "sale",
      title: "Item Sold!",
      details: "Your listing 'Mini Fridge' has been sold.",
      timestamp: new Date().toISOString(),
      read: true
    },
    {
      id: 3,
      userEmail: "test@ucf.edu",
      type: "review",
      title: "New Review",
      details: "You received a 5-star review for 'Bookshelf'.",
      timestamp: new Date().toISOString(),
      read: false
    }
  ];
  localStorage.setItem("notifications", JSON.stringify(sample));
}

loadNotifications();
</script>

</body>
</html>
