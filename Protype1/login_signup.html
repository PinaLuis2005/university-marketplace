<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login / Sign Up</title>
  <link rel="stylesheet" href="login_signup.css">
  <style>
    .password-wrapper {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .toggle-btn {
      cursor: pointer;
      background: none;
      border: none;
      font-size: 14px;
      color: #007bff;
    }
  </style>
</head>
<body>

<script>
  // If already logged in, honor any saved redirect or go home
  const existingUser = JSON.parse(localStorage.getItem("userProfile")) || JSON.parse(localStorage.getItem("loggedInUser"));
  if (existingUser && existingUser.email) {
    const redirectPage = localStorage.getItem("redirectAfterLogin");
    if (redirectPage) {
      localStorage.removeItem("redirectAfterLogin");
      window.location.href = redirectPage;
    } else {
      window.location.href = "index.html";
    }
  }
</script>

<div class="container-login-signup">
  <!-- Sign In -->
  <div class="box sign-in-box">
    <h2>Sign In</h2>
    <form class="sign-in-form">
      <label for="signin-identity">Email or Phone</label>
      <input type="text" id="signin-identity" name="signin-identity" placeholder="you@example.com" required>

      <label for="signin-password">Password</label>
      <div class="password-wrapper">
        <input type="password" id="signin-password" name="signin-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
        <button type="button" class="toggle-btn" onclick="togglePassword('signin-password')">üëÅ Show</button>
      </div>

      <div class="forgot-password"><a href="#">Forgot Password?</a></div>

      <button type="submit">Login</button>

      <div class="separator">‚Äî OR ‚Äî</div>

      <button type="button" class="google-button">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google icon" />
        Continue with Google
      </button>

      <div class="switch-link">
        <span>Don‚Äôt have an account?</span> <a href="#">Sign Up</a>
      </div>
    </form>
  </div>

  <!-- Sign Up -->
  <div class="box sign-up-box">
    <h2>Sign Up</h2>
    <form class="sign-up-form">
      <label for="signup-name">Full Name</label>
      <input type="text" id="signup-name" name="signup-name" placeholder="Your Name" required>

      <label for="signup-identity">Email or Phone</label>
      <input type="text" id="signup-identity" name="signup-identity" placeholder="you@example.com" required>

      <label for="signup-password">Password</label>
      <div class="password-wrapper">
        <input type="password" id="signup-password" name="signup-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
        <button type="button" class="toggle-btn" onclick="togglePassword('signup-password')">üëÅ Show</button>
      </div>

      <label for="signup-password-confirm">Confirm Password</label>
      <div class="password-wrapper">
        <input type="password" id="signup-password-confirm" name="signup-password-confirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
        <button type="button" class="toggle-btn" onclick="togglePassword('signup-password-confirm')">üëÅ Show</button>
      </div>

      <button type="submit">Create Account</button>

      <div class="separator">‚Äî OR ‚Äî</div>

      <button type="button" class="google-button">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google icon" />
        Continue with Google
      </button>

      <div class="switch-link">
        <span>Already have an account?</span> <a href="#">Log In</a>
      </div>
    </form>
  </div>
</div>

<!-- Scripts -->
<script>
  // Helpers
  function getUsers() {
    return JSON.parse(localStorage.getItem("users")) || [];
  }
  function saveUsers(users) {
    localStorage.setItem("users", JSON.stringify(users));
  }
  function persistSession(user) {
    localStorage.setItem("userProfile", JSON.stringify(user));
    localStorage.setItem("loggedInUser", JSON.stringify(user));
    localStorage.setItem("loggedInUserId", user.email);
  }

  // Toggle password visibility
  function togglePassword(id) {
    const input = document.getElementById(id);
    input.type = input.type === "password" ? "text" : "password";
  }

  // LOGIN
  document.querySelector(".sign-in-form").addEventListener("submit", function (e) {
    e.preventDefault();

    const identity = document.getElementById("signin-identity").value.trim();
    const password = document.getElementById("signin-password").value;

    const users = getUsers();
    const user = users.find(u => u.email === identity && u.password === password);

    if (user) {
      persistSession(user);
      alert("Login successful!");

      const redirectPage = localStorage.getItem("redirectAfterLogin");
      if (redirectPage) {
        localStorage.removeItem("redirectAfterLogin");
        window.location.href = redirectPage;
      } else {
        window.location.href = "index.html";
      }
    } else {
      alert("Invalid email or password.");
    }
  });

  // SIGN UP
  document.querySelector(".sign-up-form").addEventListener("submit", function (e) {
    e.preventDefault();

    const name = document.getElementById("signup-name").value.trim();
    const identity = document.getElementById("signup-identity").value.trim();
    const password = document.getElementById("signup-password").value;
    const confirmPassword = document.getElementById("signup-password-confirm").value;

    if (password !== confirmPassword) {
      alert("Passwords do not match!");
      return;
    }

    let users = getUsers();
    const existingUser = users.find(u => u.email === identity);
    if (existingUser) {
      alert("User already exists.");
      return;
    }

    const newUser = {
      name: name,
      email: identity,
      password: password,
      bio: "",
      profilePic: "",
      coverPhoto: ""
    };

    users.push(newUser);
    saveUsers(users);

    // Auto-login new user
    persistSession(newUser);

    alert("Account created successfully!");
    window.location.href = "index.html";
  });
</script>

</body>
</html>
